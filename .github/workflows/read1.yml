name: Obfuscate Worker.zip

on:
  push:
    paths:
      - 'release/assets/worker.zip'
  workflow_dispatch:

jobs:
  obfuscate:
    runs-on: ubuntu-latest

    steps:
    - name: 检出代码
      uses: actions/checkout@v3

    - name: 解压文件
      run: |
        mkdir worker_unzipped
        unzip release/assets/worker.zip -d worker_unzipped

    - name: 安装 ProGuard
      run: |
        sudo apt update
        sudo apt install proguard

    - name: 运行混淆
      run: |
        proguard @proguard-rules.pro -injars worker_unzipped -outjars worker_obfuscated

    - name: 压缩混淆后的文件
      run: |
        zip -r worker_obfuscated.zip worker_obfuscated

    - name: 上传到仓库
      uses: actions/upload-artifact@v3
      with:
        name: worker-obfuscated
        path: worker_obfuscated.zip
